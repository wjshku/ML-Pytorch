{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 57,
   "id": "904ae7f2",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Imports\n",
    "import torch\n",
    "import torchvision\n",
    "from torchvision.datasets import MNIST"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "23431917",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Download training dataset\n",
    "dataset = MNIST(root='data/', download=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "cfb184c8",
   "metadata": {},
   "outputs": [],
   "source": [
    "test_dataset = MNIST(root='data/', train=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "4efb4745",
   "metadata": {},
   "outputs": [],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "id": "cc4da6af",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Label: 5\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "image, label = dataset[0]\n",
    "plt.imshow(image, cmap='gray')\n",
    "print('Label:', label)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "455fb1be",
   "metadata": {},
   "outputs": [],
   "source": [
    "import torchvision.transforms as transforms\n",
    "# MNIST dataset (images and labels)\n",
    "dataset = MNIST(root='data/', \n",
    "                train=True,\n",
    "                transform=transforms.ToTensor())\n",
    "img_tensor,label = dataset[0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "366e2bc9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "torch.Size([1, 28, 28]) 5\n",
      "tensor([[0.0039, 0.6039, 0.9922, 0.3529, 0.0000],\n",
      "        [0.0000, 0.5451, 0.9922, 0.7451, 0.0078],\n",
      "        [0.0000, 0.0431, 0.7451, 0.9922, 0.2745],\n",
      "        [0.0000, 0.0000, 0.1373, 0.9451, 0.8824],\n",
      "        [0.0000, 0.0000, 0.0000, 0.3176, 0.9412]])\n",
      "tensor(1.) tensor(0.)\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "print(img_tensor.shape,label)\n",
    "print(img_tensor[0,10:15,10:15])\n",
    "print(torch.max(img_tensor), torch.min(img_tensor))\n",
    "# Plot the image by passing in the 28x28 matrix\n",
    "plt.imshow(img_tensor[0,10:15,10:15], cmap='gray');"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "8bea80e7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(50000, 10000)"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# https://www.tutorialsteacher.com/python/magic-methods-in-python\n",
    "# tensor.__len__() is the same as len(tensor), because len is a magic method\n",
    "from torch.utils.data import random_split\n",
    "\n",
    "train_ds, val_ds = random_split(dataset, [50000, 10000])\n",
    "len(train_ds), len(val_ds)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 159,
   "id": "795cf46a",
   "metadata": {},
   "outputs": [],
   "source": [
    "from torch.utils.data import DataLoader\n",
    "batch_size = 128\n",
    "train_loader = DataLoader(train_ds, batch_size, shuffle=True)\n",
    "val_loader = DataLoader(val_ds, batch_size)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 49,
   "id": "58a45a41",
   "metadata": {},
   "outputs": [],
   "source": [
    "import torch.nn as nn\n",
    "\n",
    "input_size = 28*28\n",
    "num_classes = 10\n",
    "\n",
    "# Logistic regression model\n",
    "model = nn.Linear(input_size, num_classes)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6280356c",
   "metadata": {},
   "outputs": [],
   "source": [
    "print(model.weight.shape)\n",
    "print(model.weight)\n",
    "print(model.bias.shape)\n",
    "model.bias"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "dd289db7",
   "metadata": {},
   "outputs": [],
   "source": [
    "for images, labels in train_loader:\n",
    "    print(labels)\n",
    "    print(images.shape)\n",
    "    images = torch.reshape(images,(128,784))\n",
    "    outputs = model(images)\n",
    "    print(outputs)\n",
    "    break"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "ba5c1544",
   "metadata": {},
   "outputs": [],
   "source": [
    "#We define a model here by ourselves so that we do not need to do the reshape every time\n",
    "class Mymodel(nn.Module):\n",
    "    def __init__(self):\n",
    "        super().__init__()\n",
    "        self.linear = nn.Linear(input_size, num_classes)\n",
    "    def forward(self,xb):\n",
    "        xb = xb.reshape(-1,input_size)\n",
    "        out = self.linear(xb)\n",
    "        return out\n",
    "model = Mymodel()  "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "2d7877cf",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "torch.Size([10, 784]) torch.Size([10])\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "[Parameter containing:\n",
       " tensor([[-0.0161,  0.0318, -0.0188,  ...,  0.0308,  0.0330, -0.0266],\n",
       "         [ 0.0337, -0.0319, -0.0022,  ..., -0.0111,  0.0234, -0.0300],\n",
       "         [-0.0250, -0.0006, -0.0328,  ...,  0.0160, -0.0144, -0.0066],\n",
       "         ...,\n",
       "         [-0.0053,  0.0276, -0.0107,  ...,  0.0067,  0.0133, -0.0337],\n",
       "         [-0.0062, -0.0224, -0.0250,  ...,  0.0107,  0.0087, -0.0211],\n",
       "         [-0.0325,  0.0279,  0.0271,  ..., -0.0308, -0.0217, -0.0291]],\n",
       "        requires_grad=True),\n",
       " Parameter containing:\n",
       " tensor([-0.0283,  0.0068,  0.0161, -0.0074, -0.0185,  0.0116,  0.0147,  0.0011,\n",
       "          0.0307,  0.0010], requires_grad=True)]"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Check how our model works\n",
    "model.linear\n",
    "print(model.linear.weight.shape, model.linear.bias.shape)\n",
    "list(model.parameters())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 166,
   "id": "907a8484",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "torch.Size([128, 1, 28, 28])\n",
      "tensor([[ 1.1288, -3.2538,  1.4205,  ..., -0.8388, -1.1720, -1.6289],\n",
      "        [-2.2524,  0.7457,  0.0295,  ..., -1.2189,  0.9931,  0.2954],\n",
      "        [-0.7380, -0.3657,  0.0964,  ..., -2.2763,  0.7354, -0.7760],\n",
      "        ...,\n",
      "        [ 0.4936, -2.2101,  0.3707,  ..., -2.2678,  1.1083, -1.7581],\n",
      "        [ 1.0912,  0.0219, -0.9189,  ..., -1.0488,  1.7987, -1.2825],\n",
      "        [-1.4395, -0.7756,  2.4351,  ...,  0.3740,  1.9879, -1.6966]],\n",
      "       grad_fn=<AddmmBackward>)\n"
     ]
    }
   ],
   "source": [
    "for images, labels in train_loader:\n",
    "    print(images.shape)\n",
    "    outputs = model(images)\n",
    "    break\n",
    "print(outputs)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 167,
   "id": "e3e89046",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Sample probabilities:\n",
      " tensor([[0.0821, 0.0010, 0.1099, 0.0087, 0.0476, 0.0733, 0.6525, 0.0115, 0.0082,\n",
      "         0.0052],\n",
      "        [0.0067, 0.1348, 0.0659, 0.0564, 0.3400, 0.0345, 0.0841, 0.0189, 0.1727,\n",
      "         0.0859]])\n",
      "Sum:  1.0\n",
      "tensor([6, 4, 6, 5, 9, 9, 9, 5, 7, 6, 3, 2, 4, 6, 4, 9, 6, 3, 7, 7, 2, 0, 6, 1,\n",
      "        6, 6, 6, 7, 6, 2, 0, 6, 7, 6, 7, 6, 9, 0, 8, 8, 9, 1, 4, 1, 5, 6, 3, 0,\n",
      "        3, 9, 9, 2, 4, 5, 0, 0, 8, 0, 9, 9, 9, 9, 1, 5, 6, 2, 6, 8, 7, 8, 2, 8,\n",
      "        9, 7, 7, 9, 5, 8, 0, 8, 9, 9, 5, 5, 3, 4, 3, 3, 5, 1, 8, 2, 1, 1, 6, 5,\n",
      "        4, 1, 5, 2, 6, 7, 8, 4, 3, 3, 6, 1, 7, 0, 7, 0, 2, 1, 9, 2, 5, 8, 6, 2,\n",
      "        6, 6, 3, 8, 2, 5, 5, 2])\n",
      "tensor([6, 4, 6, 3, 9, 9, 9, 5, 7, 6, 3, 2, 4, 6, 4, 9, 6, 3, 7, 7, 2, 0, 6, 7,\n",
      "        6, 6, 6, 7, 6, 2, 0, 2, 7, 6, 7, 6, 7, 0, 8, 8, 9, 1, 4, 1, 7, 6, 3, 0,\n",
      "        3, 9, 8, 2, 4, 5, 0, 0, 8, 0, 9, 9, 9, 9, 1, 5, 6, 2, 6, 8, 7, 8, 6, 1,\n",
      "        9, 7, 7, 9, 5, 5, 0, 8, 9, 7, 5, 5, 3, 4, 3, 3, 5, 5, 8, 2, 1, 1, 6, 5,\n",
      "        9, 1, 5, 2, 6, 7, 8, 4, 3, 3, 6, 1, 7, 0, 7, 0, 2, 1, 9, 2, 5, 8, 6, 2,\n",
      "        6, 6, 3, 1, 2, 5, 5, 2])\n",
      "tensor([0.6525, 0.3400, 0.4841, 0.5030, 0.7920, 0.6377, 0.8082, 0.8553, 0.4551,\n",
      "        0.8574, 0.5535, 0.3888, 0.6091, 0.9793, 0.8756, 0.5078, 0.9367, 0.4497,\n",
      "        0.5531, 0.5089, 0.8813, 0.9306, 0.5474, 0.7927, 0.9177, 0.9128, 0.9001,\n",
      "        0.6311, 0.5741, 0.9894, 0.7542, 0.4840, 0.5176, 0.8817, 0.9481, 0.5084,\n",
      "        0.2621, 0.9154, 0.3730, 0.7891, 0.7143, 0.9197, 0.8614, 0.9252, 0.2317,\n",
      "        0.9069, 0.6574, 0.8189, 0.4976, 0.7446, 0.6921, 0.8386, 0.8883, 0.7148,\n",
      "        0.8673, 0.9891, 0.8954, 0.8883, 0.6311, 0.7533, 0.5499, 0.5815, 0.8919,\n",
      "        0.4472, 0.6016, 0.8987, 0.6607, 0.7498, 0.5385, 0.8085, 0.2689, 0.4858,\n",
      "        0.4784, 0.8263, 0.9051, 0.7078, 0.7287, 0.3128, 0.9287, 0.3032, 0.6305,\n",
      "        0.4608, 0.5095, 0.5764, 0.5230, 0.6463, 0.5967, 0.6663, 0.5223, 0.3640,\n",
      "        0.5823, 0.7054, 0.8196, 0.7532, 0.8329, 0.8645, 0.2408, 0.9168, 0.8315,\n",
      "        0.9147, 0.7870, 0.9323, 0.8003, 0.7382, 0.6302, 0.3645, 0.7407, 0.8168,\n",
      "        0.9237, 0.6947, 0.8809, 0.9123, 0.8464, 0.8892, 0.7653, 0.9478, 0.4457,\n",
      "        0.7734, 0.9490, 0.9929, 0.9886, 0.8385, 0.8428, 0.6742, 0.9696, 0.5599,\n",
      "        0.5665, 0.3923], grad_fn=<MaxBackward0>)\n"
     ]
    }
   ],
   "source": [
    "import torch.nn.functional as F\n",
    "# Apply softmax for each output row\n",
    "probs = F.softmax(outputs, dim=1)\n",
    "# Look at sample probabilities\n",
    "print(\"Sample probabilities:\\n\", probs[:2].data)\n",
    "\n",
    "# Add up the probabilities of an output row\n",
    "print(\"Sum: \", torch.sum(probs[0]).item())\n",
    "\n",
    "max_probs, preds = torch.max(probs, dim=1)\n",
    "print(preds)\n",
    "print(labels)\n",
    "print(max_probs)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "81d51025",
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'labels' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-19-718edc4f454e>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m      9\u001b[0m     \u001b[0moutput\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mreshape\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0moutput\u001b[0m\u001b[1;33m,\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m-\u001b[0m\u001b[1;36m1\u001b[0m\u001b[1;33m,\u001b[0m\u001b[1;36m10\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     10\u001b[0m     \u001b[1;32mreturn\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0moutput\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m---> 11\u001b[1;33m \u001b[0mtargets\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mrelabels\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mlabels\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m     12\u001b[0m \u001b[0mprint\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtargets\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;36m2\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     13\u001b[0m \u001b[0mprint\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mlabels\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;36m2\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'labels' is not defined"
     ]
    }
   ],
   "source": [
    "#This function is used to extend our result to x*10 matrix\n",
    "def relabels(labels):\n",
    "    output = torch.zeros(10)\n",
    "    output[labels[0].item()] = 1\n",
    "    for label in labels[1:]:\n",
    "        temp = torch.zeros(10)\n",
    "        temp[label.item()] = 1\n",
    "        output = torch.cat((output,temp),0)\n",
    "    output = torch.reshape(output,(-1,10))\n",
    "    return(output)\n",
    "targets = relabels(labels)\n",
    "print(targets[:2])\n",
    "print(labels[:2])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "effd12a8",
   "metadata": {},
   "outputs": [],
   "source": [
    "#print(torch.sum(preds == labels))\n",
    "def accuracy(outputs, labels):\n",
    "    _, preds = torch.max(outputs, dim=1)\n",
    "    return torch.tensor(torch.sum(preds == labels).item() / len(preds))\n",
    "#accuracy(outputs, labels)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "f8266371",
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'probs' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-17-582de91503ee>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m      3\u001b[0m     \u001b[0mloss\u001b[0m \u001b[1;33m=\u001b[0m \u001b[1;33m-\u001b[0m\u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0msum\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mmul\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mlog\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mpreds\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mtargets\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      4\u001b[0m     \u001b[1;32mreturn\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mloss\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m----> 5\u001b[1;33m \u001b[0mprint\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mmul\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtorch\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mlog\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mprobs\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mtargets\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      6\u001b[0m \u001b[0mloss\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mmyloss\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mprobs\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mtargets\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      7\u001b[0m \u001b[0mprint\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mloss\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'probs' is not defined"
     ]
    }
   ],
   "source": [
    "#Write my loss function\n",
    "def myloss(preds,targets):\n",
    "    loss = -torch.sum(torch.mul(torch.log(preds),targets))\n",
    "    return(loss)\n",
    "print(torch.mul(torch.log(probs[0]),targets[0]))\n",
    "loss = myloss(probs[0],targets[0])\n",
    "print(loss)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "8d4671f9",
   "metadata": {},
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'outputs' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-12-e9ebc32dfd72>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m      5\u001b[0m \u001b[0mloss_fn\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mF\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mcross_entropy\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      6\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m----> 7\u001b[1;33m \u001b[0mloss\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mloss_fn\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0moutputs\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mlabels\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      8\u001b[0m \u001b[0mprint\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mloss\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      9\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mNameError\u001b[0m: name 'outputs' is not defined"
     ]
    }
   ],
   "source": [
    "import torch.nn.functional as F\n",
    "#The nn.functional package contains many useful loss functions and several other utilities.\n",
    "\n",
    "# Define loss function\n",
    "loss_fn = F.cross_entropy\n",
    "\n",
    "loss = loss_fn(outputs, labels)\n",
    "print(loss)\n",
    "\n",
    "opt = torch.optim.SGD(model.parameters(), lr=1e-3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "c42fb61d",
   "metadata": {},
   "outputs": [],
   "source": [
    "def myfit(num_epochs,train_dl,val_dl,model,loss_fn,opt):\n",
    "    history = []\n",
    "    for epoch in range(num_epochs):\n",
    "        for images,labels in train_dl:\n",
    "            preds = model(images)\n",
    "            targets = relabels(labels)\n",
    "            probs = F.softmax(preds, dim=1)\n",
    "            loss = loss_fn(probs,targets)\n",
    "            loss.backward()\n",
    "            opt.step()\n",
    "            opt.zero_grad()\n",
    "            break\n",
    "        if (epoch+1)%10 == 0:\n",
    "            result = evaluate(model,val_dl)\n",
    "            history.append(result)\n",
    "    return(history)\n",
    "            \n",
    "def fit(num_epochs,train_dl,model,loss_fn,opt):\n",
    "    for epoch in range(num_epochs):\n",
    "        for images,labels in train_dl:\n",
    "            preds = model(images)\n",
    "            loss = loss_fn(preds,labels)\n",
    "            loss.backward()\n",
    "            opt.step()\n",
    "            opt.zero_grad()\n",
    "            break\n",
    "        # Print the progress\n",
    "        if (epoch+1) % 10 == 0:\n",
    "            print('Epoch [{}/{}], Loss: {:.4f}'.format(epoch+1, num_epochs, loss.item()))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 83,
   "id": "9edca74c",
   "metadata": {},
   "outputs": [],
   "source": [
    "def evaluate(model, val_loader):\n",
    "    outputs = [model.validation_step(batch) for batch in val_loader]\n",
    "    return model.validation_epoch_end(outputs)\n",
    "\n",
    "class MnistModel(nn.Module):\n",
    "    def __init__(self):\n",
    "        super().__init__()\n",
    "        self.linear = nn.Linear(input_size, num_classes)\n",
    "        \n",
    "    def forward(self, xb):\n",
    "        xb = xb.reshape(-1, 784)\n",
    "        out = self.linear(xb)\n",
    "        return out\n",
    "    \n",
    "    def training_step(self, batch):\n",
    "        images, labels = batch \n",
    "        out = self(images)                  # Generate predictions\n",
    "        loss = F.cross_entropy(out, labels) # Calculate loss\n",
    "        return loss\n",
    "    \n",
    "    def validation_step(self, batch):\n",
    "        images, labels = batch \n",
    "        out = self(images)                    # Generate predictions\n",
    "        loss = F.cross_entropy(out, labels)   # Calculate loss\n",
    "        acc = accuracy(out, labels)           # Calculate accuracy\n",
    "        return {'val_loss': loss, 'val_acc': acc}\n",
    "        \n",
    "    def validation_epoch_end(self, outputs):\n",
    "        batch_losses = [x['val_loss'] for x in outputs]\n",
    "        epoch_loss = torch.stack(batch_losses).mean()   # Combine losses\n",
    "        batch_accs = [x['val_acc'] for x in outputs]\n",
    "        epoch_acc = torch.stack(batch_accs).mean()      # Combine accuracies\n",
    "        return {'val_loss': epoch_loss.item(), 'val_acc': epoch_acc.item()}\n",
    "    \n",
    "    def epoch_end(self, epoch, result):\n",
    "        print(\"Epoch [{}], val_loss: {:.4f}, val_acc: {:.4f}\".format(epoch, result['val_loss'], result['val_acc']))\n",
    "\n",
    "def fit_pro(epochs, lr, model, train_loader, val_loader, opt_func=torch.optim.SGD):\n",
    "    optimizer = opt_func(model.parameters(), lr)\n",
    "    history = [] # for recording epoch-wise results\n",
    "    \n",
    "    for epoch in range(epochs):\n",
    "        \n",
    "        # Training Phase \n",
    "        for batch in train_loader:\n",
    "            loss = model.training_step(batch)\n",
    "            loss.backward()\n",
    "            optimizer.step()\n",
    "            optimizer.zero_grad()\n",
    "        \n",
    "        # Validation phase\n",
    "        result = evaluate(model, val_loader)\n",
    "        model.epoch_end(epoch, result)\n",
    "        history.append(result)\n",
    "\n",
    "    return history"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "id": "c414f41d",
   "metadata": {},
   "outputs": [],
   "source": [
    "model = MnistModel()\n",
    "opt = torch.optim.SGD(model.parameters(), lr=1e-3)\n",
    "result0 = evaluate(model, val_loader)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "id": "746232e3",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch [10/100], Loss: 0.3664\n",
      "Epoch [20/100], Loss: 0.3715\n",
      "Epoch [30/100], Loss: 0.6188\n",
      "Epoch [40/100], Loss: 0.3133\n",
      "Epoch [50/100], Loss: 0.4165\n",
      "Epoch [60/100], Loss: 0.5402\n",
      "Epoch [70/100], Loss: 0.4570\n",
      "Epoch [80/100], Loss: 0.5253\n",
      "Epoch [90/100], Loss: 0.5320\n",
      "Epoch [100/100], Loss: 0.4474\n"
     ]
    }
   ],
   "source": [
    "fit(100, train_loader, model, loss_fn, opt)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 99,
   "id": "49c6ed3f",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[{'val_loss': 1.43230140209198, 'val_acc': 0.7762064933776855},\n",
       " {'val_loss': 1.088355302810669, 'val_acc': 0.800039529800415},\n",
       " {'val_loss': 0.9114641547203064, 'val_acc': 0.8071597814559937},\n",
       " {'val_loss': 0.7993192672729492, 'val_acc': 0.8342563509941101},\n",
       " {'val_loss': 0.7288346886634827, 'val_acc': 0.8440466523170471},\n",
       " {'val_loss': 0.6790899634361267, 'val_acc': 0.8508702516555786},\n",
       " {'val_loss': 0.6400753259658813, 'val_acc': 0.8491891026496887},\n",
       " {'val_loss': 0.6116676330566406, 'val_acc': 0.858781635761261},\n",
       " {'val_loss': 0.5883133411407471, 'val_acc': 0.8541337251663208},\n",
       " {'val_loss': 0.5660426616668701, 'val_acc': 0.8596716523170471}]"
      ]
     },
     "execution_count": 99,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "history = myfit(100, train_loader,val_loader, model, myloss, opt)\n",
    "history"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 168,
   "id": "ddc482a6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "history = [result0]+history\n",
    "accuracies = [result['val_acc'] for result in history]\n",
    "plt.plot(accuracies, '-x')\n",
    "plt.xlabel('epoch')\n",
    "plt.ylabel('accuracy')\n",
    "plt.title('Accuracy vs. No. of epochs');"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "582d57c7",
   "metadata": {},
   "outputs": [],
   "source": [
    "def cross(model,val_dl):\n",
    "    for images,labels in val_dl:\n",
    "        outputs= model(images)\n",
    "        probs = F.softmax(outputs, dim=1)\n",
    "        prediction(model,images,labels)\n",
    "        return(accuracy(outputs,labels)) \n",
    "def prediction(model,images,labels):\n",
    "    outputs = model(images)\n",
    "    probs = F.softmax(outputs, dim=1)\n",
    "    max_probs, preds = torch.max(probs, dim=1)\n",
    "    print(preds)\n",
    "    print(labels)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 74,
   "id": "4a2d6cb7",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch [0], val_loss: 1.3867, val_acc: 0.7859\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "1"
      ]
     },
     "execution_count": 74,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "history1 = fit_pro(1, 0.001, model, train_loader, val_loader)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "3142fb38",
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "opt = torch.optim.SGD(model.parameters(), lr=1e-4)\n",
    "history1 = myfit(100, train_loader,val_loader, model, myloss, opt)\n",
    "history = history + history1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "84751213",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "accuracies = [result['val_acc'] for result in history]\n",
    "plt.plot(accuracies, '-x')\n",
    "plt.xlabel('epoch')\n",
    "plt.ylabel('accuracy')\n",
    "plt.title('Accuracy vs. No. of epochs');"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 101,
   "id": "0684e04b",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Next, lets test our model on individual images\n",
    "# Define test dataset\n",
    "test_dataset = MNIST(root='data/', \n",
    "                     train=False,\n",
    "                     transform=transforms.ToTensor())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "73ec595d",
   "metadata": {},
   "outputs": [],
   "source": [
    "def pre_img(image,model):\n",
    "    output = model(image)\n",
    "    _,pred = torch.max(output,dim=1)\n",
    "    return(pred)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 157,
   "id": "5cf64563",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "471\n",
      "Shape: torch.Size([1, 28, 28])\n",
      "Label: 9\n",
      "Predict: 9\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "number = torch.randint(0,1000,(1,)).item()\n",
    "print(number)\n",
    "img, label = test_dataset[number]\n",
    "plt.imshow(img[0], cmap='gray')\n",
    "print('Shape:', img.shape)\n",
    "print('Label:', label)\n",
    "print('Predict:',pre_img(img,model).item())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 161,
   "id": "ef0b5876",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'val_loss': 0.5316900014877319, 'val_acc': 0.878710925579071}"
      ]
     },
     "execution_count": 161,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "test_dataloader = DataLoader(test_dataset,batch_size = 256)\n",
    "evaluate(model,test_dataloader)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 162,
   "id": "d175010c",
   "metadata": {},
   "outputs": [],
   "source": [
    "torch.save(model.state_dict(), 'mnist-logistic.pth')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 164,
   "id": "73888597",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OrderedDict([('linear.weight',\n",
       "              tensor([[ 0.0114,  0.0149, -0.0163,  ..., -0.0069, -0.0306, -0.0297],\n",
       "                      [ 0.0321, -0.0226, -0.0118,  ...,  0.0213,  0.0197, -0.0100],\n",
       "                      [ 0.0035,  0.0140,  0.0343,  ..., -0.0221, -0.0159, -0.0088],\n",
       "                      ...,\n",
       "                      [ 0.0033, -0.0151,  0.0144,  ..., -0.0302, -0.0075,  0.0066],\n",
       "                      [-0.0224, -0.0226, -0.0058,  ...,  0.0297, -0.0066, -0.0344],\n",
       "                      [ 0.0010, -0.0291, -0.0184,  ..., -0.0332, -0.0255,  0.0156]])),\n",
       "             ('linear.bias',\n",
       "              tensor([ 0.0299,  0.0052,  0.0350, -0.0278,  0.0249, -0.0113, -0.0219,  0.0281,\n",
       "                       0.0305, -0.0300]))])"
      ]
     },
     "execution_count": 164,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model2 = MnistModel()\n",
    "model2.state_dict()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 165,
   "id": "d6f59e03",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<All keys matched successfully>"
      ]
     },
     "execution_count": 165,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model2.load_state_dict(torch.load('mnist-logistic.pth'))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "31dc7674",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Part3: Housing"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 171,
   "id": "92200312",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Imports\n",
    "import torch\n",
    "import jovian\n",
    "import torchvision\n",
    "import torch.nn as nn\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import torch.nn.functional as F\n",
    "from torchvision.datasets.utils import download_url\n",
    "from torch.utils.data import DataLoader, TensorDataset, random_split"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 169,
   "id": "462011cc",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Hyperparameters\n",
    "batch_size=64\n",
    "learning_rate=5e-7\n",
    "\n",
    "\n",
    "# Other constants\n",
    "DATASET_URL = \"https://raw.githubusercontent.com/selva86/datasets/master/BostonHousing.csv\"\n",
    "DATA_FILENAME = \"BostonHousing.csv\"\n",
    "TARGET_COLUMN = 'medv'\n",
    "input_size=13\n",
    "output_size=1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "dfa00672",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Dataset & Dataloader"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 172,
   "id": "439257bc",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "100.3%"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Downloading https://raw.githubusercontent.com/selva86/datasets/master/BostonHousing.csv to .\\BostonHousing.csv\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>crim</th>\n",
       "      <th>zn</th>\n",
       "      <th>indus</th>\n",
       "      <th>chas</th>\n",
       "      <th>nox</th>\n",
       "      <th>rm</th>\n",
       "      <th>age</th>\n",
       "      <th>dis</th>\n",
       "      <th>rad</th>\n",
       "      <th>tax</th>\n",
       "      <th>ptratio</th>\n",
       "      <th>b</th>\n",
       "      <th>lstat</th>\n",
       "      <th>medv</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0.00632</td>\n",
       "      <td>18.0</td>\n",
       "      <td>2.31</td>\n",
       "      <td>0</td>\n",
       "      <td>0.538</td>\n",
       "      <td>6.575</td>\n",
       "      <td>65.2</td>\n",
       "      <td>4.0900</td>\n",
       "      <td>1</td>\n",
       "      <td>296</td>\n",
       "      <td>15.3</td>\n",
       "      <td>396.90</td>\n",
       "      <td>4.98</td>\n",
       "      <td>24.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0.02731</td>\n",
       "      <td>0.0</td>\n",
       "      <td>7.07</td>\n",
       "      <td>0</td>\n",
       "      <td>0.469</td>\n",
       "      <td>6.421</td>\n",
       "      <td>78.9</td>\n",
       "      <td>4.9671</td>\n",
       "      <td>2</td>\n",
       "      <td>242</td>\n",
       "      <td>17.8</td>\n",
       "      <td>396.90</td>\n",
       "      <td>9.14</td>\n",
       "      <td>21.6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0.02729</td>\n",
       "      <td>0.0</td>\n",
       "      <td>7.07</td>\n",
       "      <td>0</td>\n",
       "      <td>0.469</td>\n",
       "      <td>7.185</td>\n",
       "      <td>61.1</td>\n",
       "      <td>4.9671</td>\n",
       "      <td>2</td>\n",
       "      <td>242</td>\n",
       "      <td>17.8</td>\n",
       "      <td>392.83</td>\n",
       "      <td>4.03</td>\n",
       "      <td>34.7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0.03237</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.18</td>\n",
       "      <td>0</td>\n",
       "      <td>0.458</td>\n",
       "      <td>6.998</td>\n",
       "      <td>45.8</td>\n",
       "      <td>6.0622</td>\n",
       "      <td>3</td>\n",
       "      <td>222</td>\n",
       "      <td>18.7</td>\n",
       "      <td>394.63</td>\n",
       "      <td>2.94</td>\n",
       "      <td>33.4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0.06905</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.18</td>\n",
       "      <td>0</td>\n",
       "      <td>0.458</td>\n",
       "      <td>7.147</td>\n",
       "      <td>54.2</td>\n",
       "      <td>6.0622</td>\n",
       "      <td>3</td>\n",
       "      <td>222</td>\n",
       "      <td>18.7</td>\n",
       "      <td>396.90</td>\n",
       "      <td>5.33</td>\n",
       "      <td>36.2</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      crim    zn  indus  chas    nox     rm   age     dis  rad  tax  ptratio  \\\n",
       "0  0.00632  18.0   2.31     0  0.538  6.575  65.2  4.0900    1  296     15.3   \n",
       "1  0.02731   0.0   7.07     0  0.469  6.421  78.9  4.9671    2  242     17.8   \n",
       "2  0.02729   0.0   7.07     0  0.469  7.185  61.1  4.9671    2  242     17.8   \n",
       "3  0.03237   0.0   2.18     0  0.458  6.998  45.8  6.0622    3  222     18.7   \n",
       "4  0.06905   0.0   2.18     0  0.458  7.147  54.2  6.0622    3  222     18.7   \n",
       "\n",
       "        b  lstat  medv  \n",
       "0  396.90   4.98  24.0  \n",
       "1  396.90   9.14  21.6  \n",
       "2  392.83   4.03  34.7  \n",
       "3  394.63   2.94  33.4  \n",
       "4  396.90   5.33  36.2  "
      ]
     },
     "execution_count": 172,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Download the data\n",
    "download_url(DATASET_URL, '.')\n",
    "dataframe = pd.read_csv(DATA_FILENAME)\n",
    "dataframe.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 173,
   "id": "c8b42684",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((506, 13), (506, 1))"
      ]
     },
     "execution_count": 173,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Convert from Pandas dataframe to numpy arrays\n",
    "inputs = dataframe.drop('medv', axis=1).values\n",
    "targets = dataframe[['medv']].values\n",
    "inputs.shape, targets.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 174,
   "id": "a0a00286",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Convert to PyTorch dataset\n",
    "dataset = TensorDataset(torch.tensor(inputs, dtype=torch.float32), torch.tensor(targets, dtype=torch.float32))\n",
    "train_ds, val_ds = random_split(dataset, [406, 100])\n",
    "\n",
    "train_loader = DataLoader(train_ds, batch_size, shuffle=True)\n",
    "val_loader = DataLoader(val_ds, batch_size*2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fb63933d",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 188,
   "id": "4d1fa23b",
   "metadata": {},
   "outputs": [],
   "source": [
    "class HousingModel(nn.Module):\n",
    "    def __init__(self):\n",
    "        super().__init__()\n",
    "        self.linear = nn.Linear(input_size, output_size)\n",
    "        \n",
    "    def forward(self, xb):\n",
    "        out = self.linear(xb)\n",
    "        return out\n",
    "    \n",
    "    def training_step(self, batch):\n",
    "        inputs, targets = batch \n",
    "        out = self(inputs)                 # Generate predictions\n",
    "        loss = F.mse_loss(out, targets)    # Calculate loss\n",
    "        return loss\n",
    "    \n",
    "    def validation_step(self, batch):\n",
    "        inputs, targets = batch \n",
    "        out = self(inputs)                 # Generate predictions\n",
    "        loss = F.mse_loss(out, targets)    # Calculate loss\n",
    "        return {'val_loss': loss.detach()}\n",
    "        \n",
    "    def validation_epoch_end(self, outputs):\n",
    "        batch_losses = [x['val_loss'] for x in outputs]\n",
    "        epoch_loss = torch.stack(batch_losses).mean()\n",
    "        #epoch_loss = sum(batch_losses)/len(batch_losses)\n",
    "        return {'val_loss':epoch_loss.item()}\n",
    "        #return {'val_loss':epoch_loss}\n",
    "        \n",
    "    def epoch_end(self, epoch, result):\n",
    "        print(\"Epoch [{}], val_loss: {:.4f}\".format(epoch, result['val_loss']))\n",
    "    \n",
    "model = HousingModel()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "914a0802",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Training"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 176,
   "id": "a780b225",
   "metadata": {},
   "outputs": [],
   "source": [
    "def evaluate(model, val_loader):\n",
    "    outputs = [model.validation_step(batch) for batch in val_loader]\n",
    "    return model.validation_epoch_end(outputs)\n",
    "\n",
    "def fit(epochs, lr, model, train_loader, val_loader, opt_func=torch.optim.SGD):\n",
    "    history = []\n",
    "    optimizer = opt_func(model.parameters(), lr)\n",
    "    for epoch in range(epochs):\n",
    "        # Training Phase \n",
    "        for batch in train_loader:\n",
    "            loss = model.training_step(batch)\n",
    "            loss.backward()\n",
    "            optimizer.step()\n",
    "            optimizer.zero_grad()\n",
    "        # Validation phase\n",
    "        result = evaluate(model, val_loader)\n",
    "        model.epoch_end(epoch, result)\n",
    "        history.append(result)\n",
    "    return history"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 189,
   "id": "1a0affc3",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "{'val_loss': 986.7291259765625}"
      ]
     },
     "execution_count": 189,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "result = evaluate(model,val_loader)\n",
    "result"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 190,
   "id": "e9e8d94a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch [0], val_loss: 178.5065\n",
      "Epoch [1], val_loss: 164.0450\n",
      "Epoch [2], val_loss: 158.0918\n",
      "Epoch [3], val_loss: 153.7888\n",
      "Epoch [4], val_loss: 150.8697\n",
      "Epoch [5], val_loss: 151.4453\n",
      "Epoch [6], val_loss: 146.5511\n",
      "Epoch [7], val_loss: 146.0607\n",
      "Epoch [8], val_loss: 143.9241\n",
      "Epoch [9], val_loss: 148.1671\n"
     ]
    }
   ],
   "source": [
    "history = fit(10, learning_rate, model, train_loader, val_loader)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 191,
   "id": "4987cee4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "losses = [r['val_loss'] for r in [result] + history]\n",
    "plt.plot(losses, '-x')\n",
    "plt.xlabel('epoch')\n",
    "plt.ylabel('val_loss')\n",
    "plt.title('val_loss vs. epochs');"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1c8a9612",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Prediction"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 192,
   "id": "913b5eab",
   "metadata": {},
   "outputs": [],
   "source": [
    "def predict_single(x, model):\n",
    "    xb = x.unsqueeze(0)\n",
    "    return model(x).item()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 193,
   "id": "85688ccd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Input:  tensor([  0.4124,   0.0000,   6.2000,   0.0000,   0.5040,   7.1630,  79.9000,\n",
      "          3.2157,   8.0000, 307.0000,  17.4000, 372.0800,   6.3600])\n",
      "Target:  31.600000381469727\n",
      "Prediction: 16.561443328857422\n"
     ]
    }
   ],
   "source": [
    "x, target = val_ds[10]\n",
    "pred = predict_single(x, model)\n",
    "print(\"Input: \", x)\n",
    "print(\"Target: \", target.item())\n",
    "print(\"Prediction:\", pred)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 199,
   "id": "3a803f95",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "tensor([[  0.4124,   0.0000,   6.2000,   0.0000,   0.5040,   7.1630,  79.9000,\n",
       "           3.2157,   8.0000, 307.0000,  17.4000, 372.0800,   6.3600]])"
      ]
     },
     "execution_count": 199,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "x.unsqueeze(0) \n",
    "# Returns a new tensor with a dimension of size one inserted at the specified position.\n",
    "#https://pytorch.org/docs/stable/generated/torch.unsqueeze.html"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
